# Abelian varieties in Hesse form

This package contains code to compute with elliptic curves and abelian surfaces in Hesse form. 
Part of it is based on the article ABELIAN SURFACES IN HESSE FORM
AND EXPLICIT ISOGENY FORMULAS by Thomas Decru and Sabrina Kunzweiler.

## Example

The following example is also described in the above mentioned article. It concerns the computation of a 
$$(9,9)$$-isogeny between two products of elliptic curves. 

We work over a finite field containing a third root of unity, and consider the elliptic curve 
$$E_1: y^2 = x^3+1$$. 

```
sage: Fp = FiniteField(2*5*3^3-1)
sage: R.<x> = Fp[]
sage: K.<om> = Fp.extension(x^2+x+1)
sage: E1 = EllipticCurve(K,[0,1])
```

In the setup, we create a $$(9,9)$$-isogeny diamond built from
a $$5$$-isogeny and multiplication by $$2$$. Further, we construct auxiliary
27-torsion points that will be used in later computations.

```
sage: P5 = E1.lift_x(8)
sage: assert P5.order() == 5
sage: phi = E1.isogeny(P5)
sage: E2 = phi.codomain()

sage: P27 = E0([252,71])
sage: Q27 = E0([7*om, 13*om+141])

sage: P1,Q1 = 2*P27, 2*Q27 # on E1
sage: P2,Q2 = phi(Q27), phi(P27) # on E2
```

Now, we use the functionality implemented in `hessian_arithmetic_dim1` to
translate everything to elliptic curves in Hesse form. To make the transformations
deterministic, we specify  $$3$$-torsion bases that are used to compute these
transformations.

```
sage: P1_3,Q1_3 = 9*P1, 9*Q1
sage: P2_3,Q2_3 = 9*P2, 9*Q2

sage: H1 = EllipticCurveHessianForm(E1, basis=[P1_3,Q1_3]); H1
Elliptic Curve in Hessian form defined by x^3 + y^3 + 6*x*y*z + z^3 over Finite Field in om of size 269^2
sage: H2 = EllipticCurveHessianForm(E2, basis=[P2_3,Q2_3]): H2
Elliptic Curve in Hessian form defined by x^3 + y^3 + (54*om + 54)*x*y*z + z^3 over Finite Field in om of size 269^2
```

Note that we remember the explicit transformation. In particular, we can map points from `E1` to `H1`.

```
sage: H1._trafo
[127*om + 198            0 261*om + 253]
[127*om + 198     4*om + 8     4*om + 8]
[127*om + 198 265*om + 261     4*om + 8]
sage: P = E1.random_element()
sage: Q = H1.map_point(P); Q # random
(62*om + 91 : 104*om + 158 : 44*om + 72)
sage: H1(list(H1._trafo*vector(P))) == Q
True
```

We map the basis points to points in Hesse form.

```
sage: R1 = H1.map_point(P1)
sage: R2 = H2.map_point(Q2)
sage: S1 = H1.map_point(Q1)
sage: S2 = H2.map_point(P2)
```

In the next step, we need functionality from `hessian_arithmetic_dim2` in
order to construct the product surface. 

```
sage: A0 = AbelianSurfaceHessianForm([H2,H1], omega=om); A0
Abelian surface in Hessian form with coefficients d = (36*om + 36, 251*om + 251, 267, 1, 1), h =  (0, 0, 0, 268, 1) over Finite Field in om of size 269^2
```

In the following, we want to compute the isogeny with kernel $$\langle(3 P_1, 3Q_2),(3P_2,3Q_1)\rangle$$. 
We construct (points above) the generators on the product surface.

```
sage: R = A0([R2,R1]); R
(13*om + 79 : 94*om + 254 : 17*om + 81 : 252*om + 229 : 155*om + 101 : 214*om + 226 : 114*om + 230 : 242*om + 58 : 117*om + 268)
sage: S = A0([S2,S1]); S
(115*om + 223 : 236*om + 62 : 159*om + 49 : 221*om + 58 : 56*om + 249 : 130*om + 266 : 135*om + 164 : 66*om + 213 : 117*om + 93)
```

We further construct some auxiliary points: 
(a) $$9$$-torsion points for the first step of the computation
(b) a random point for the computation of the codomain in the last step

```
sage: R1_9, R2_9 = H1.map_point(P1_9), H2.map_point(Q2_9)
sage: S1_9, S2_9 = H1.map_point(Q1_9), H2.map_point(P2_9)
sage: R_9, S_9 = A0([R2_9,R1_9]), A0([S2_9,S1_9])

sage: aux1 = H1.map_point(E1.random_element())
sage: aux2 = H2.map_point(E2.random_element())
sage: auxP = A0([aux2,aux1])
```

Now we can compute the isogey chain with kernel generated by `3*R, 3*S`:

```
sage: Phi = compute_isogeny_chain((R,S), (R_9,S_9), 2, (0,1,0), auxP=auxP); Phi
Composite morphism of abelian surfaces in Hesse form
domain: Abelian surface in Hessian form with coefficients d = (36*om + 36, 251*om + 251, 267, 1, 1), h =  (0, 0, 0, 268, 1) over Finite Field in om of size 269^2
codomain: Abelian surface in Hessian form with coefficients d = (175*om + 38, 47*om + 250, 149*om + 176, 211*om + 7, 178*om + 86), h =  (1, 268, 268, 268*om, om + 1) over Finite Field in om of size 269^2
```

Note that the codomain is again a product of elliptic curves. We can recover the product structure
as follows:

```
sage: B = Phi.codomain()
sage: B.is_reducible()
True
sage: trafo = B.product_structure_transformation()
sage: B = trafo.codomain()
sage: d = B._d
sage: h = B._h
sage: assert h[3] + h[4] == 0 and h[0] == 0 and h[1] == 0 and h[2] == 0
```

Another sanity check:

```
sage: d1 = d[0]/d[1]
sage: d2 = d[0]/d[2]
sage: G1 = EllipticCurveHessianForm(d1)
sage: G2 = EllipticCurveHessianForm(d2)
sage: G1.j_invariant() == E2.j_invariant()
True
sage: G2.j_invariant() == E1.j_invariant()
True
```

## Remarks

In the current implementation, several checks are performed when creating an abelian surface in Hesse form,
or points on this surface. In particular, the equations defining the surface are computed explicitly. Of course, this is not necessary in an
implementation aimed at more efficient computations.
